---
title: "Using the rmd2pdf-guide"
subtitle: "All the News that is Fit to Print"
guideurl: http://crmda.ku.edu/guides
author:
- name: Paul Johnson 
  affiliation: CRMDA
  description: Director
  email: crmda@ku.edu
- name:  Brent Kaplan 
  affiliation: CRMDA
  description: GRA
  email: crmda@ku.edu
output: 
  pdf_document:
    citation_package: natbib
    keep_tex: true
    fig_caption: true
    latex_engine: pdflatex
    template:  "`r system.file('theme/guide-boilerplate.tex', package = 'crmda')`"
    pandoc_args: [
      "--listings"
    ]
addr:
    l1: 1425 Jayhawk Blvd
    l2: Watson Library, Suite 470
    l3: Lawrence, KS 66045-7594
    r1: "Phone: 785-864-3353"
    r2: "Web: http://crmda.ku.edu"
    r3: "Email: crmda@ku.edu"
logoleft: theme/logoleft.pdf
logoright: theme/logo-vert.pdf
bibliography: theme/mlm.bib
fontsize: 11pt
header-includes:
- \usepackage{xcolor}
---

```{r setup, include=FALSE}
##This Invisible Chunk is required in all CRMDA documents
tmpdir <- paste0("tmpout")
if (!dir.exists(tmpdir)) dir.create(tmpdir, recursive = TRUE)
knitr::opts_chunk$set(echo=TRUE, comment=NA, fig.path=paste0(tmpdir, "/p-"))
options(width = 70)
```

```{r themecopy, include = FALSE}
library(crmda)
## If theme directory does not have required images or TeX files
## we need to retrieve them and put them in "theme" directory. 
logos <- c(logoleft = "logoleft.pdf", 
           logoright = "logo-vert.pdf")
files <- c("guide-boilerplate.tex", "mlm.bib")
getFiles(logos, pkg = "crmda")
getFiles(files, pkg = "crmda")
```

# Nuts and Bolts

## Minor header edits only

The header has a place to insert a title, subtitle, email
addresses. Do not change the `pdf_document` settings unless you want
to get serious.

## To compile this document

To compile, either start R and use the function `rmd2pdf` or use the
shell script `rmd2pdf.sh` that is in the same directory as the `Rmd`
file. The function `rmd2pdf` (same as the script) supplies settings. The
user can supply many arguments to control the table of contents and so
forth.

Compiling the document will also produce an R file that is a "tangled"
version of the code chunks in the document.

## Document customization: essentials


The document header depends on a \LaTeX template called
"guide-boilerplate.tex".  That will be copied to the theme directory
the first time a document is compiled in this directory. If you do
want to edit the theme boilerplate, edit
theme/guide-boilerplate.tex. Make sure the compiler uses that
document.  If you use our compiler script or the R function rmd2pdf,
it is necessary to supply the template argument with the function
call.

That is, it is not sufficient to insert a template name in the YAML
header, and it is also not sufficient to use Rstudio's "knit" menu.
One must specify the template argument with `rmd2pdf`.


# Much \LaTeX\ Syntax is allowed

This is explained in the `crmda` package vignette `Rmarkdown`.

Use `\[` and `\[` for display equations:

\[
\Sigma_{gt}=\Lambda_{gt}\Psi_{gt}\Lambda'_{gt}+\Theta_{gt}
\]

Because the backend is PDF and LaTeX will compile the document,
numbered equations and cross references will succeed. Use
`\begin{equation}` and `\end{equation}`:

\begin{equation}
\Sigma_{gt}=\Lambda_{gt}\Psi_{gt}\Lambda'_{gt}+\Theta_{gt}\label{eq:sem}
\end{equation}

That is equation (\ref{eq:sem}). If we put in another equation, you
will see it is automatically numbered:

\begin{equation}
y_i=\beta_0 + \beta_{1}X_i\label{eq:reg}
\end{equation}

That's equation (\ref{eq:reg}).

## Additional packages

In addition, if you insert \LaTeX features that require packages
that are not currently in the report-boilerplate.tex, then those
packages can be inserted into the preamble by YAML header markup like
so:

```
header-includes:
-  \usepackage{xcolor}
-  \usepackage{amsmath}
-  \usepackage{amssymb}
-  \usepackage{fancybox}
```

That example has the package `amssymb` because some non-standard math
symbols were needed.


# `R` code chunks


In guide documents, we do generally include input and output from code
chunks. We have not yet mastered steps necessary to customize the
output of code chunks when using Rmarkdown, so the output received
here is beyond our control at the moment. This is a principal reason
why working with Sweave is more desirable for our purposes.

First, suppose we create a data frame

```{r ex-1, echo=TRUE}
set.seed(1234)
x <- rnorm(100, 0, 1)
y <- rnorm(100, 0, 1)
dat <- data.frame(x=x, y=y)
```

Of course, because this is guide, we are also likely to have some ugly
raw R output.

```{r ex-4, echo=TRUE}
summary(dat)
```

Readers should notice the document template numbers the lines in both
input and output chunks. This can be changed by altering the template.

We can show ugly output if we really need to. But we'd rather include
lovely graphs or nicely formatted \LaTeX tables.

When tables are concerned, the placement of tables is the major issue.
Sometimes we like tables that are "numbered floating"
objects. However, because this is a guide document, we might want the
\LaTeX table output to show "right here" (prevent it from floating
into a numbered table). The following code shows that the print.xtable
method allows us to control that.  

The following creates output that does not go into a floating
object. Note
the output will blurt into the document, immediately after the code
chunk itself:

```{r ex-2, results='asis', echo=TRUE}
library(xtable)
xt <- xtable(head(dat, 10), caption="Ten Lines from One Data Frame",
             label="tab:ex2")
print(xt, comment=FALSE, include.rownames=FALSE, floating=FALSE)
```
Note that because the print.xtable arguments include "floating=FALSE",
the table caption is not printed with the output table.  The concept
of caption is meaningful only for floating tables, as we illustrate next.

A more professional result is obtained if we allow xtable to create a
"floating" table object.  The following code creates Table
\ref{tab:ex2}.

```{r ex-3, results='asis', echo=TRUE}
print(xt, comment=FALSE, include.rownames=FALSE, floating=TRUE,
      caption.placement = "top")
```

For whatever reason, the custom is that captoins (titles) of tables are placed
**on top** while titles for figures are placed on the bottom.

As explained in the `crmda` vignette `code_chunks`, many 
options are avaiable for code chunks.


# Bibliographical citation test is appropriate. {-}

This document is produced with R [@RCore]. Here's a citation that
excludes some author names [-@diggle_analysis_2013, p. 37]. Note that
to get the full parenthesized statement with names and dates, we
insert hard brackets `[`, an `@` sign, the bibtex tag, and a closer
`]`. If we don't want their names, we insert a `-` sign. It is also
possible to refer to a group of projects [@hsiao_analysis_2014;
@fitzmaurice_applied_2011; @mccullagh_nelder_1983].

The style of the bibliography will not match what we generally
want. It is close to what we want. The default is 
based on the Chicago author-year format.


# Session Info

This is a required element in a guide

```{r session}
sessionInfo()
if (!is.null(warnings())){
    print("Warnings:")
    warnings()
}
```

# References
