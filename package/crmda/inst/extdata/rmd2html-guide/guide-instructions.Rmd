---
title: "Instructions on Preparing CRDMA Guide Documents"
subtitle: "Style and compilation guidance"
author:
 - name: Paul Johnson
   affiliation: Center for Research Methods and Data Analysis, University of Kansas
   email: pauljohn@ku.edu
 - name: Zack Roman
   affiliation: Center for Research Methods and Data Analysis, University of Kansas
   email: zroman@ku.edu
 - name: "Please visit [http://crmda.ku.edu/guides](http://crmda.ku.edu/guides) for updates."
 - name: "Tags: guides, markdown, guides"

abstract: This instruction describes
    several key features/functionalities of R Markdown for producing
    colorful and vivid HTML format Guide documents. The demonstrations
    include embedding R code into an .Rmd file, inserting
    mathematical expressions (equations and matrices), and displaying
    R output and graphs/images. A careful study of this document will
    help learners to gain a basic understanding of the rmd2html
    workflow, especially when using it to create CRMDA Guide
    documents.
checked_by: "First Last"
Note to Authors: please_dont_change_the_next 4 lines!
date: "`r format(Sys.time(), '%Y %B %d')`"
output:
  html_document:
    toc: TRUE
    toc_depth: 3
    highlight: haddock
---

```{r setup, include=FALSE}
##This Invisible Chunk is required in all CRMDA documents
outdir <- paste0("tmpout")
if (!file.exists(outdir)) dir.create(outdir, recursive = TRUE)
knitr::opts_chunk$set(echo=TRUE, comment=NA, fig.path=paste0(outdir, "/p-"))
options(width = 70)
```

# CRMDA Guides

A guide is intended for students or other learners. It is not a format
suitable for reports to clients or journal articles. A guide will
generally include code and output excerpts.

# Using the ```crmda``` package

The crmda package provides template files and functions to convert
from Rmarkdown to HTML and PDF format. This document is about the HTML
"backend". Different guides are needed for HTML and PDF backends
because some features are unique.

The crmda package provides a cascading style sheet file that is
intended to standardize our presentation across all guides. In order
to begin with an R markdown guide, start R in a folder where you would
like to create a write-up and run

```
> initWriteup("rmd2html-guide")
```

That should copy the template, this instruction document, and some
other files into a directory named "writeup". When the document is
compiled, it will import some formatting information from the ```crmda```
package.

Open the file "guide-template.Rmd" in a text editor. Insert
your name or a title and save the document. 	
	
The file can be compiled either by opening an R session and using
the function ```rmd2html()```, for example by running in R:

```
> library(crmda)
> rmd2html("guide-instructions.Rmd")
```

The ```rmd2html``` function allows other arguments that will
be passed through to the render and html_document functions in
the ```Rmarkdown``` and ```knitr``` packages for R. This is
explained in the documentation.

It is not necessary to open R to compile this document. The 
output can also be generated by running a command line script 
that does the same work. 

```
$ ./rmd2html.sh guide-instructions.Rmd
```

The rendered output (an HTML) file can be opened using Firefox or Chrome/Chromium.

```
$ firefox guide-instructions.html
```

If one uses Rstudio as a text editor for an Rmd file, one may not
obtain satisfactory output by compiling the document with the built-in
menu system because that menu system is not aware of the settings and
cascading style sheet file that we are using. Avid Rstudio users can,
we believe, customize their configurations to achieve satisfactory
results.


# Document Preparation Basics

## Use a text editor

A markdown file is a "raw text" file. Don't edit it with MS Word.
Instead, use a programmers file editor, such as Emacs, Notepad++,
or a integrated development environment, such as Rstudio, to edit
the file.

We have three methods of beautifying text and creating structures.

## Rmarkdown

First, we have Rmarkdown formatting. Brief examples might include the
fact that *italics* result from bracketing a word with asterixes
(\*italics\*), **boldface** results from two asterixes
(```**boldface**```). Section headers are defined by pound signs,
where one pound sign is a "level 1" heading. There are 6 levels
allowed. Numbered lists can be created by putting a number in column
1 of a new line, followed by a space.  A bullet point list is created
by putting an asterix in column 1 of a new line, followed by a space.

These examples indicate that Rmarkdown is similar to, but exactly
the same, as the general Markdown standard
(https://daringfireball.net/projects/markdown)
or other dialects, such as GitHub Flavored Markdown
(https://github.github.com/gfm). Advice
for one dialect may not apply in an Rmarkdown document. Google
searches will sometimes lead to the wrong answer for a particular
form of Markdown.

For technical documentation, see

1. "R Markdown Reference Guide" (https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)
2. "R Markdown Cheatsheet"
   (https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)
3. Yihui Xie. 2015. *Dynamic Documents with R and Knitr. 2ed* Boca
Raton, Florida: Chapman Hall/CRC. http://yihui.name/knitr.  On July 7,
2017, Xie made available a new book manuscript, "bookdown: Authoring
Books and Technical Documents with R Markdown"
(https://bookdown.org/yihui/bookdown).

User-friendly overviews and tutorials on Rmarkdown usage are available.

1. The Rmarkdown page at Rstudio corporation,
   http://rmarkdown.rstudio.com. There is general information and an
   Rmarkdown "Get Started" Tutorial,
   http://rmarkdown.rstudio.com/lesson-1.html. The Rstudio corporation
   employs many of the leading developers of R markdown.

2. Cosma Shalizi, "Using R Markdown for Class Reports",
   http://www.stat.cmu.edu/~cshalizi/rmarkdown.

Because the document translation *pandoc* plays a critical role in the
conversion of documents from markdown into HTML, documentation for
pandoc will often be definitive.  Along those lines, we point
readers to the Pandoc Markdown reference manual at Rstudio:
http://rmarkdown.rstudio.com/authoring_pandoc_markdown.html.


## Raw HTML

Because this document will eventually be compiled into an HTML file,
we are allowed to insert HTML tags. While the Markdown movement is no
doubt inspired by disappointment with the complicated, unreadable
nature of HTML code, it does not prevent the use of HTML markup
("markdown" is a play on words, to be the opposite of "markup").
Rather than the simpler markdown, for example, one might write HTML
<b>bold</b> or <span style="font-weight:bold">bold in another
way</span> in HTML. The HTML markup for these, ```<b>bold</b>```
or  ```<span style="font-weight:bold">bold in another way</span>``` is
arguably less readable, but it is allowed.  The key point is the
following: If something is unavailable in the Rmarkdown toolkit, one
can directly write with HTML to achieve the purpose.

Using raw HTML markup might be considered a defeat for the would-be
Rmarkdown document writer, but sometimes (perhaps less often now than
a year ago) HTML markup is the only workable option.

The document translation software is surprisingly effective at
converting special characters.  For example, in HTML documents, one
cannot use the less than or greater than symbols in text because they
are markdown separators. In HTML, one would need to insert ```&lt;```
to represent $<$.  The document conversion programs are aware of this,
however, so that symbols in the markdown file that would ordinarily
"break" the HTML document, like < , >, or &, are gracefully
(automatically) converted to ```&lt;```, ```&gt;``` and ```&amp;```.

Similarly, a forbidden dollar sign in $234.23 would ordinarly crash a
LaTeX document, where one would be required to escape the dollar 
sign, ```\$234.23```, but the Rmarkdown conversion process seems to handle
the un-escaped dollar sign gracefully.


## $\LaTeX$ markup

$\LaTeX$ markup for math can be used within the Rmd file. This is
**not** a sure-fire success. The HTML document will not be readable in
all Web browsers.  The central problem is that the HTML output file
contains a form of markup that is converted--in the Web browser--via
javascript and functions supplied interactively from the MathJax Web
server. The $\LaTeX$ result is not "embedded" in the HTML, it is
instead "available for rendering" in the Webpage. Over the years,
however, we observe that the MathJax display system works better and
better and today, for the most part, it *almost always works* if users
are online when they try to browse the HTML file and if javascript
blockers do not interfere with the rendering process in the Web
browser. If a user is offline, or the MathJax web server is not
responding, the raw markup will appear.  Users will see \$\LaTeX\$
rather than $\LaTeX$.

Unlike HTML code, not all $\LaTeX$ markdown is allowed in an Rmarkdown
document. One cannot insert italics with $\LaTeX$.  
Inserting ```\emph{italics}``` or bold ```\textbf{bold}``` in the
style of $\LaTeX$ code will have no effect.

Rmarkdown allows the insertion of in-line math markup in the same way
that math is introduced in $\LaTeX$ documents. Code is bracketed with
dollar signs, as in ```$\alpha$``` to write $\alpha$ or ```$\f_{ij}
x_{i} \times y{j}^2$``` to write $\f_{ij} x_{i} \times y{j}$.

Displayed equations--equations that are centered or otherwise set
apart from the text--can be created in several ways. Although the double-dollar
sign method is allowed, it is suggested instead to bracket a displayed
equation with ```\[``` and ```\]```. Compare the inline mode, $\bar{x} =
\frac{1}{n} \sum_{i=1}^{n}x_{i}$ (from ```$\bar{x} =
\frac{1}{n} \sum_{i=1}^{n}x_{i}$```) with the display equation output:

\[
\bar{x} = \frac{1}{n} \sum_{i=1}^{n}x_{i}
\]

that results from

```
\[
\bar{x} = \frac{1}{n} \sum_{i=1}^{n}x_{i}
\]
```

$\LaTeX$ has several math-customized packages that are widely used and
we run into contradictory advice about how to write equations.  

One can also use the $\LaTeX$ ```\begin{equation}```, which comes from
the $\LaTeX$ package *amsmath*.

\begin{equation}
A_{m,n} = \left(\begin{array}{ccc}
a & b & c\\
d & e & f\\
g & h & i\\
\end{array}\right)
\label{eq:another1}
\end{equation}

We don't know if there is a comprehensive list of which $\LaTeX$ math
symbols are allowed, but we wish somebody would find one.  Here are formulae that do work.

\]
P(A|B) = \frac{P(B|A)P(A)}{P(B)}
\]

\]
f(y|N,p) = \frac{N!}{y!(N-y)!}\cdot p^y \cdot (1-p)^{N-y} 
= {{N}\choose{y}} \cdot p^y \cdot (1-p)^{N-y}
\]

We have success with all of the usual $\LaTeX$ methods to create
fractions, $\frac{2}{3}$, hats, $\hat{\lambda}$,
$\sqrt{square~roots}$, binary operators, $+$ $-$ $\times$ $=$
$\approx$ $\ne$ $\ge$ $\lt$ $\pm$ $\sim$ $\rightarrow$, symbols like
$\pi$ and $\infty$, and all Greek letters are available.

This is not the right place for a comprehensive guide to $\LaTeX$.
Users will need to install a $\LaTeX$ distribution and then a
user-friendly editor that will help create equation markup.  Many
users in the CRMDA lab use LyX, which offers a "View source" feature
to inspect $\LaTeX$ coding for equations.

###Equation Numbering

To designate numbered equations, we can manually assign equation
numbers. Unfortunately, markdown to HTML does not support
auto-numbering equations by default. However, you can designate static
equation numbers by adding```\tag{}``` to the end of equations:

<!-- TODO: Use different symbols here than before  -->
\[ + - = \approx \ne \ge \lt \pm\tag{1} \]
\[ \pi \approx 3.1415927\tag{2} \]
\[ a_i \ge 0~~~\forall i\tag{3} \]
\[ x \lt 15\tag{4} \]



##Knit (incorporate R code and output)

A code chunk is a runable piece of R code.  As the Rmd file is
compiled, its results of chunks are accumulated in an R session.  One
can run a command and then refer to its output in following
chunks. This makes it convenient to introduce R examples for readers.

In a $\LaTeX$ document, for which this technology was invented, the 
code chunks are created by a somewhat cumbersome notation:

```
<<>>=
lm(y ~ x, data = dat)
@
```

In Rmarkdown, the outer boundaries are changed to three back ticks, along with squiggly braces.


``` ```{r}```

```lm(y ~ x, data = dat)```
	
```  ``` ```

This allows for the full functionality of the R programming
environment to be "knitted" into a markdown report. Code chunks have
many options which can be aplied to change the functionality of a
specific chunk. The following link presents a well organized list of
some potential chunk options.

https://yihui.name/knitr/options/

###Plots

Plots or figures can be added to any Markdown document through the use of R code chunks. 

```{r myFirstPlot, dev=c('png','pdf'), fig.keep='all'}
hist(rnorm(500))
```

```{r}
x <- rnorm(1000)
print(x[1:20])
```

```{r mySecondPlot, dev=c('png','pdf'), fig.keep='all'}
hist(rnorm(20))
```

###Graphics & Figures

We can use mapping for geographically oriented information.

<!-- ```{r, echo = FALSE, warning = FALSE} -->
<!-- library(maps) -->
<!-- par(mar=rep(0, 4)) -->
<!-- map("nz", fill=TRUE, col="grey80") -->
<!-- points(174.75, -36.87, pch=16, cex=2) -->
<!-- arrows(172, -36.87, 174, -36.87, lwd=3) -->
<!-- text(172, -36.87, "Auckland  ", adj=1, cex=.9) -->

<!-- maplocs <- map(projection="sp_mercator", wrap=TRUE, lwd=0.1,  -->
<!--                col="dodgerblue", ylim=c(-60, 75), -->
<!--                interior=FALSE, orientation=c(90, 180, 0), add=TRUE, -->
<!--                plot=FALSE) -->
<!-- xrange <- range(maplocs$x, na.rm=TRUE) -->
<!-- yrange <- range(maplocs$y, na.rm=TRUE) -->
<!-- aspect <- abs(diff(yrange))/abs(diff(xrange)) -->
<!-- # customised to 6.5 by 4.5 figure size -->
<!-- par(fig=c(0.99 - 0.5, 0.99, 0.01, 0.01 + 0.5*aspect*4.5/6.5),  -->
<!--     mar=rep(0, 4), new=TRUE) -->
<!-- plot.new() -->
<!-- plot.window(xlim=xrange, -->
<!--             ylim=yrange) -->
<!-- map(projection="sp_mercator", wrap=TRUE, lwd=0.1, ylim=c(-60, 75), -->
<!--     interior=FALSE, orientation=c(90, 180, 0), add=TRUE) -->
<!-- symbols(-.13, -0.8, circles=1, inches=0.1, add=TRUE) -->
<!-- ``` -->

<!-- Sometimes a figure expresses more than words. Figures can also be included in R markdown documents. -->

<!-- ```{r, echo = FALSE, warning =FALSE} -->
<!-- par(xaxs="i", yaxs="i", xpd=FALSE) -->
<!--     plot(c(0, 1), c(0, 1), type="n", ann=FALSE, axes=FALSE) -->
<!--     box("figure") -->
<!--     rect(0, 0, 1, 1, col="light grey", border="grey") -->
<!--     axis(1, at=c(0, 1), c("", "")) -->
<!--     mtext("Min x", side=1, adj=0, line=1) -->
<!--     mtext("Max x", side=1, adj=1, line=1) -->
<!--     axis(2, at=c(0, 1), c("", "")) -->
<!--     mtext("Min y", side=2, adj=0, line=1) -->
<!--     mtext("Max y", side=2, adj=1, line=1) -->
<!--     lines(c(.6, .6, 0), c(0, .6, .6), lty="dashed") -->
<!--     text(.6, .6, expression(paste("The location ",  -->
<!--             group("(",list(x[i], y[i]),")"))), pos=3) -->
<!--     points(.6, .6, pch=16) -->
<!--     axis(1, at=.6, "") -->
<!--     mtext(expression(x[i]), side=1, at=.6, line=.7) -->
<!--     axis(2, at=.6, "") -->
<!--     mtext(expression(y[i]), side=2, at=.6, line=.7) -->
        
<!-- ``` -->



### Tables

Here is an example of the rockchalk packages model comparison table

```{r, warning = FALSE, error = FALSE, message= FALSE,include=FALSE}
library(rockchalk)
   set.seed(2134234)
   dat <- data.frame(x1 = rnorm(100), x2 = rnorm(100))
   dat$y1 <- 30 + 5 * rnorm(100) + 3 * dat$x1 + 4 * dat$x2
   dat$y2 <- rnorm(100) + 5 * dat$x2
   m1 <- lm(y1 ~ x1, data = dat)
   m2 <- lm(y1 ~ x2, data = dat)
   m3 <- lm(y1 ~ x1 + x2, data = dat)
   gm1 <- glm(y1 ~ x1, family = Gamma, data = dat)

or1 <- outreg(list("Amod" = m1, "Bmod" = m2, "Gmod" = m3),
title = "My Three Linear Regressions", float = FALSE, type = "html",
browse = FALSE)
or1 <- gsub("&nbsp;"," ", or1)
or1 <- gsub("^\\ *", "", or1)
or1 <- paste(or1, collapse = "")
or1 <- gsub("\\ \\ \\ \\ \\ \\ ", " ", or1)
or1 <- gsub("\\ \\ \\ ", " ", or1)
```

```{r,results="asis"}
cat(or1)
```

We have settled on Xtable as a great table producing package which offers flexability and functionality.

```{r, results="asis"}
    library(xtable)
    or2 <- xtable(summary(m1))
    print(or2, type="html")
```

```{r, results="asis"}
    library(psych)
print(xtable(describe(dat)),type = "html")
    
```

# Special Features for Rmd into HTML documents.

HTML documents allow for interactivity as compared to other forms of markdown output. Below are some unique features we take advantage of in HTML output.


## Collored Callouts

Callouts allow the user to specify code chunks, tables, plots, or paragraphs to be collored. This is a great way to get your readers attention. These are always preceded by four # signs. Yes, ####. We stole this idea from other
styles and put them into ours. See usage of {.bs-callout.bs-callout-whatever_you_put here}, where whatever_you_put_here iseither "gray", "red", "orange", "blue", or "green".
   
```{r, eval=FALSE, include=FALSE}
bscols <- data.frame(old = c("info", "warning", "danger"),
                     new = c("blue", "orange", "red"))
```

### Demonstrating Callouts

#### Gray Callout {.bs-callout .bs-callout-gray}
Content here: Gray for wisdom

#### Red Callout {.bs-callout .bs-callout-red}
Red for warnings

#### Orange Callout {.bs-callout .bs-callout-orange}
Orange for examples

#### Blue Callout {.bs-callout .bs-callout-blue}
Blue for right answers

#### Green Callout {.bs-callout .bs-callout-green}
Green for future directions


#### R code inside a callout {.bs-callout .bs-callout-red}
```{r xsummary}
summary(x)
```
	  


## Interactive Tabs

If you'd like, you can include interactive tabs to HTML reports. Maybe you want to show two similar versions of the same analysis. Or maybe something else. Whatever it may be, be sure to include `{.tabset .tabset-fade}` along with a level 2 header (##). For each tab, put the information under the level 3 header (###). Use another level 2 header to get out of the tabs mode.

The only way (that we know of) to get colors is to wrap the tab headers in a `<span style>` as shown below. This might be useful to draw attention to the tabs. Blue is the default color.
#### What tabs look like {.bs-callout .bs-callout-blue}

```
## You have the ability to include tabs {.tabset .tabset-fade}

If you'd like, you can include different tabs. Maybe you want to show
two similar versions of the same analysis. Or maybe something
else. Whatever it may be, be sure to include `{.tabset .tabset-fade}`
along with a level 2 header (##). For each tab, put the information
under the level 3 header (###). Use another level 2 header to get out
of the tabs mode.

The only way (that we know of) to get colors is to wrap the tab
headers in a `<span style>` as shown below. This might be useful to
draw attention to the tabs. Blue is the default color.

### <span style="color:red">First Tab Here</span>

Some information you'd like to show.

### <span style="color:orange">Second Tab Here</span>

Some more information you'd like to show.

Some more information you'd like to show.

### Third Tab Here

Some final information you'd like to show.

Some final information you'd like to show.

Some final information you'd like to show.
```

## {.tabset .tabset-fade}

### <span style="color:red">First Tab Here</span>

Some information you'd like to show.

### <span style="color:orange">Second Tab Here</span>

Some more information you'd like to show.

Some more information you'd like to show.

### Third Tab Here

Some final information you'd like to show.

Some final information you'd like to show.

Some final information you'd like to show.


## International characters

Accented letters, often in non-English names, like

Karl Gustav Jöreskog and Dag Sörbom

Linda Muthén and Bengt Muthén


# Policies about writing in these documents. {.bs-callout .bs-callout-red}

1. Use these callouts to attract attention.

2. Blank rows separate paragraphs.

3. The character width of rows should be 80 or less. I have no idea
how anybody thinks they have a right to impose an infinitely long row,
but it's bad. Edit the document with Emacs, run M-q to get
re-positioned text. If your editor cannot do that, quit using it.

4. Must make sure compiling using the kutils.css located in the crmda
package. For example, `crmda::rmd2html("filename.Rmd")`


[//]: (All guides must have this as the final stanza)

```{r sessionInfo, echo = FALSE}
sessionInfo()
```

Available under
[Created Commons license 3.0 <img src="http://crmda.dept.ku.edu/images/cc-3.0.png" alt="CC BY"
style="width: 75px;height: 20px;"/>](http://creativecommons.org/licenses/by/3.0/)

