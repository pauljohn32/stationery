
% $ This nullifies emacs subscripting in following%
%%BEGIN: This begins the custom header
\usepackage{array, tabularx}
\usepackage{xparse}
\usepackage{setspace}
\usepackage{babel}
\usepackage{datetime}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{colortbl}

\definecolor{darkblue}{HTML}{1e2277}
\definecolor{kublue81186}{RGB}{0,81,186}
\newdateformat{monddyyy}{\shortmonthname[\THEMONTH].~\THEDAY,~\THEYEAR}

% \ExplSyntaxOn
% \NewDocumentCommand \reportsetup { +m }
% {
%   \bool_set_false:N \l_report_twoauthors_bool
%   \bool_set_false:N \l_report_threeauthors_bool
%   \keys_set:nn { report } { #1 }
% }
% \keys_define:nn { report }
% {
%     firstauthor .code:n = {
%       \keys_set:nn { report / firstauthor } { #1 }
%     },
%     secondauthor .code:n = {
%       \keys_set:nn { report } { twoauthors }
%       \keys_set:nn { report / secondauthor } { #1 }
%     },
%     thirdauthor .code:n = {
%       \keys_set:nn { report } { threeauthors }
%       \keys_set:nn { report / thirdauthor } { #1 }
%     },
%     twoauthors .bool_set:N = \l_report_twoauthors_bool,
%     twoauthors .default:n = true,
%     twoauthors .initial:n = false,
%     threeauthors .bool_set:N = \l_report_threeauthors_bool,
%     threeauthors .default:n = true,
%     threeauthors .initial:n = false,
%     firstauthor / firstname .tl_set:N = \l_report_first_firstname_tl,
%     firstauthor / lastname .tl_set:N = \l_report_first_lastname_tl,
%     firstauthor / affiliation .tl_set:N = \l_report_first_affil_tl,
%     firstauthor / email .tl_set:N = \l_report_first_email_tl,
%     secondauthor / firstname .tl_set:N = \l_report_second_firstname_tl,
%     secondauthor / lastname .tl_set:N = \l_report_second_lastname_tl,
%     secondauthor / affiliation .tl_set:N = \l_report_second_affil_tl,
%     secondauthor / email .tl_set:N = \l_report_second_email_tl,
%     thirdauthor / firstname .tl_set:N = \l_report_third_firstname_tl,
%     thirdauthor / lastname .tl_set:N = \l_report_third_lastname_tl,
%     thirdauthor / affiliation .tl_set:N = \l_report_third_affil_tl,
%     thirdauthor / email .tl_set:N = \l_report_third_email_tl,
%     rightlogo .tl_set:N = \l_report_rightlogo_tl,
%     title .tl_set:N = \l_report_title_tl,
%     firstauthor .initial:n = { firstname = a, lastname = b,
%       affiliation = c, email = d},
%     secondauthor .initial:n = { firstname = g, lastname = h,
%       affiliation = i, email = j},
%     thirdauthor .initial:n = { firstname = g, lastname = h,
%       affiliation = i, email = j},
%     title .initial:n = {Report ~ to ~ Reports},
% }
% \NewDocumentCommand \reporthdr { +o }
% {
%   \group_begin:
%     \IfValueT { #1 } 
%     {
%       \bool_set_false:N \l_report_twoauthors_bool 
%       \keys_set:nn { report } { #1 }
%     }
%     \report_hdr:
%     \group_end:
% }
% \cs_new_protected:Nn \report_hdr:
% {
%   \noindent\begin{minipage}[t]{6.5in}%
%     \begin{center}
%       \setlength{\tabcolsep}{2pt}
%       \setlength{\arrayrulewidth}{0.6pt}
%       \begin{tabular}[t]{@{}>{\raggedright}p{4in}>{\centering}p{2.5in}@{}}
%         \arrayrulecolor{lightgray}\hline 
%         \medskip{}
%         \textsc{\Large{}\l_report_title_tl}{\par}
%         \bigskip{}
%         \textcolor{lightgray}{\rule[0.5ex]{3.25in}{0.6pt}}
%         & \medskip{}
%           \includegraphics[width=2.5in]{\l_report_rightlogo_tl}
%           \tabularnewline
%          \multicolumn{2}{>{\raggedright}p{6in}} {
%           \textbf{\l_report_first_firstname_tl {} ~ \l_report_first_lastname_tl}, ~\l_report_first_affil_tl {} ~ <\href{mailto:\l_report_first_email_tl}{\l_report_first_email_tl}>
%           \bool_if:NT \l_report_twoauthors_bool
%           {
%         \\
%         \textbf{\l_report_second_firstname_tl {} ~ \l_report_second_lastname_tl}, ~\l_report_second_affil_tl {} ~ <\href{mailto:\l_report_second_email_tl}{\l_report_second_email_tl} >
%         }
%         \bool_if:NT \l_report_threeauthors_bool
%         {
%         \\
%         \textbf{\l_report_third_firstname_tl {} ~ \l_report_third_lastname_tl}, ~\l_report_third_affil_tl {} ~ <\href{mailto:\l_report_third_email_tl}{\l_report_third_email_tl} >
%         }
%         \par

%         \begin{singlespace}
%           \raggedright{}{\monddyyy\today}
%         \end{singlespace}
%         }\tabularnewline
%         \hline 
%       \end{tabular}
%       \par
%     \end{center}
%     \medskip{}
%     % 
%   \end{minipage}
% }
% \ExplSyntaxOff
% %%END This ends the custom header


%% BEGIN custom header
\ExplSyntaxOn
\NewDocumentCommand \reportsetup { m }
 {
  \keys_set:nn { report } { #1 }
 }

\int_new:N \g_report_authors_int
\prop_new:N \g_report_authors_prop
\tl_new:N \l__report_authors_tl

\keys_define:nn { report }
 {
  author .code:n =
   {
    \int_gincr:N \g_report_authors_int
    \keys_set:nn { report / author } { #1 }
   },
  author/firstname .code:n = { \report_add_author:nn { firstname } { #1 } },
  author/lastname .code:n = { \report_add_author:nn { lastname } { #1 } },
  author/affiliation .code:n = { \report_add_author:nn { affiliation } { #1 } },
  author/email .code:n = { \report_add_author:nn { email } { #1 } },
  leftlogo .tl_set:N = \l_report_leftlogo_tl,
  rightlogo .tl_set:N = \l_report_rightlogo_tl,
  number .tl_set:N = \l_report_number_tl,
  title .tl_set:N = \l_report_title_tl,
  keywords .tl_set:N = \l_report_keywords_tl,
  url .tl_set:N = \l_report_url_tl,
  title .initial:n = {TITLE~NEEDED},
}
\NewDocumentCommand \reporthdr { +O{} }
 {
  \group_begin:
  \keys_set:nn { report } { #1 }
  \report_hdr:
  \group_end:
 }

% \cs_new_protected:Nn \report_hdr:
%  {
%   \centering
%   \begin{tabular}
%    {
%     |c
%     m{ \dim_eval:n { \textwidth - 2.5in - 6\tabcolsep - 2\arrayrulewidth } }
%     c|
%    }
%   \hline
%   &&\tabularnewline[-\dim_eval:n { -\normalbaselineskip + 3ex }]
%   \begin{tabular}{@{}c@{}}
%   \includegraphics[width=1.25in]{\l_report_leftlogo_tl} \\[\medskipamount]
%   \small\bfseries
%   \tl_if_empty:NTF \l_report_number_tl %<--- there was a typo
%    { \leavevmode\vphantom{G} }
%    { Report~No: ~ \tl_use:N \l_guide_number_tl }
%   \end{tabular}
%   &
%   \centering
%   \textbf{\large\l_guide_title_tl\\}
%   \rule[0.5ex]{1\linewidth}{1pt} \\
%   \guide_print_authors:
%   \vspace{\bigskipamount}
%   \raggedright
%   \tl_if_empty:NF \l_guide_keywords_tl
%    {
%     \textbf{Keywords}: ~ \l_guide_keywords_tl \\
%    }
%   \tl_if_empty:NF \l_guide_url_tl
%    {
%     See ~ \url{\l_guide_url_tl} ~ for ~ updates.
%    }
%   &
%   \begin{tabular}{@{}c@{}}
%   \includegraphics[width=1.25in]{\l_guide_rightlogo_tl} \\[\medskipamount]
%   \small\bfseries\monddyyyy\today
%   \end{tabular}
%   \tabularnewline
%   \hline 
%   \end{tabular}
% }
\cs_new_protected:Nn \report_hdr:
{
  \noindent\begin{minipage}[t]{6.5in}%
    \begin{center}
      \setlength{\tabcolsep}{2pt}
      \setlength{\arrayrulewidth}{0.6pt}
      \begin{tabular}[t]{@{}>{\raggedright}p{4in}>{\centering}p{2.5in}@{}}
        \arrayrulecolor{kublue81186}\hline 
        \medskip{}
        \textsc{\Large{}\l_report_title_tl}{\par}
        \bigskip{}
        \textcolor{kublue81186}{\rule[0.5ex]{3.25in}{0.6pt}}
        & \medskip{}
          \includegraphics[width=2.5in]{\l_report_rightlogo_tl}
          \tabularnewline
         \multicolumn{2}{>{\raggedright}p{6in}}{
         \report_print_authors:
          \par
          \medskip
        \begin{singlespace}
          \raggedright{}{\monddyyy\today}
        \end{singlespace}
        }\tabularnewline
        \hline 
      \end{tabular}
      \par
    \end{center}
    \medskip{}
    % 
  \end{minipage}
}
\cs_new_protected:Nn \report_add_author:nn
 {
  \prop_gput:Nxn \g_report_authors_prop
   { #1 \int_to_arabic:n { \g_report_authors_int } }
   { #2 }
 }
\cs_generate_variant:Nn \prop_gput:Nnn { Nx }
\cs_new_protected:Nn \report_print_authors:
 {
  \tl_clear:N \l__report_authors_tl
  \int_step_inline:nnnn { 1 } { 1 } { \g_report_authors_int }
   {
    \tl_put_right:Nn \l__report_authors_tl
     {
       \prop_item:Nn \g_report_authors_prop { firstname ##1 }~
       \prop_item:Nn \g_report_authors_prop { lastname ##1 },~
       \prop_item:Nn \g_report_authors_prop { affiliation##1 }~
       \prop_item:Nn \g_report_authors_prop { <  email##1 > } \\
     }
   }
   \tl_use:N \l__report_authors_tl
 }
\ExplSyntaxOff
%%END This ends the custom header

\definecolor{darkblue}{HTML}{1e2277}
\usepackage[unicode=true,pdfusetitle,
bookmarks=true,bookmarksnumbered=false, bookmarksopen=false,
breaklinks=true, pdfborder={0 0 0},
pdfborderstyle={}, backref=false,
colorlinks=true, linkcolor=darkblue, urlcolor=darkblue,
citecolor=darkblue] {hyperref}



%% Was previously in "preambleFloatCenter.tex"
%%BEGIN: graphics and such inside floats are centered by default
\renewenvironment{figure}[1][]{%
 \ifthenelse{\equal{#1}{}}{%
   \@float{figure}
 }{%
   \@float{figure}[#1]%
 }%
 \centering
}{%
 \end@float
}
\renewenvironment{table}[1][]{%
 \ifthenelse{\equal{#1}{}}{%
   \@float{table}
 }{%
   \@float{table}[#1]%
 }%

 \centering
}{%
 \end@float
}
%%END: graphics and such inside floats are centered by default

